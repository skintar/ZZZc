# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞
–†–∞–Ω—å—à–µ, –µ—Å–ª–∏ –±–æ—Ç –∑–∞–≤–µ—Ä—à–∞–ª—Å—è –≤–æ –≤—Ä–µ–º—è –æ—Ü–µ–Ω–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–Ω–æ–≤–æ. –≠—Ç–æ –±—ã–ª–æ –Ω–µ—É–¥–æ–±–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏–π.

## –†–µ—à–µ–Ω–∏–µ
–¢–µ–ø–µ—Ä—å –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- **–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–æ—Ä–∞** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª `active_sessions.json`
- **–ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –≤—ã–±–æ—Ä–∞** - –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏** - –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è —Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –∏–∑ `active_sessions.json`
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –≤—ã–±–æ—Ä—ã, –ø—Ä–æ–≥—Ä–µ—Å—Å, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è

### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–∏ `/start` –±–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è
- –ï—Å–ª–∏ –µ—Å—Ç—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏:
  - üîÑ **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ—Ü–µ–Ω–∫—É** - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å
  - üÜï **–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ** - –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
  - üìä **–ú–æ–π —Ä–µ–π—Ç–∏–Ω–≥** - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥
  - üåç **–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–æ–ø** - –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥

### 4. –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 3600 —Å–µ–∫—É–Ω–¥ (1 —á–∞—Å)
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å –∏ –Ω–µ –∑–∞—Å–æ—Ä—è–µ—Ç —Ñ–∞–π–ª

## –§–∞–π–ª—ã

### `active_sessions.json`
```json
{
  "123456789": {
    "characters_count": 20,
    "max_comparisons": null,
    "new_characters_only": false,
    "new_character_indices": [],
    "comparisons_made": 15,
    "results": {"(0,1)": 0, "(1,2)": 1, ...},
    "wins": {"0": 5, "1": 3, "2": 7, ...},
    "choice_history": [((0,1), 0), ((1,2), 1), ...],
    "learned_preferences": {"0>1": 0.8, "1>2": 0.6, ...}
  }
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ù–µ —Ç–µ—Ä—è—é—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å** –ø—Ä–∏ —Å–±–æ—è—Ö –±–æ—Ç–∞
- **–ú–æ–≥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å** –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è
- **–í—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏–π** - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–ª–∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –≤–∏–¥—è—Ç, —á—Ç–æ –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è

### ‚úÖ –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Ç–µ—Ä—è—é—Ç –¥–∞–Ω–Ω—ã–µ
- **–ú–µ–Ω—å—à–µ –∂–∞–ª–æ–±** - –Ω–µ—Ç –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** - –Ω–µ –∑–∞—Å–æ—Ä—è–µ—Ç —Å–∏—Å—Ç–µ–º—É
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–∏–¥–Ω–æ, –∫–æ–≥–¥–∞ —Å–µ—Å—Å–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
```python
def _save_sessions(self) -> None:
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –≤ —Ñ–∞–π–ª."""
    sessions_data = {}
    for user_id, session in self._sessions.items():
        if not session.is_completed:  # –¢–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
            sessions_data[str(user_id)] = {
                "characters_count": session.characters_count,
                "comparisons_made": session.comparisons_made,
                "results": session.results,
                "wins": session.wins,
                "choice_history": session.choice_history,
                "learned_preferences": session.learned_preferences
            }
```

### –ó–∞–≥—Ä—É–∑–∫–∞
```python
def _load_sessions(self) -> None:
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞."""
    for user_id_str, session_data in data.items():
        user_id = int(user_id_str)
        session = UserSession(...)
        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
        session.comparisons_made = session_data.get("comparisons_made", 0)
        session.results = session_data.get("results", {})
        # ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
        self._sessions[user_id] = session
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
- `–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å–µ—Å—Å–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}` - –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- `–ó–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} —É–¥–∞–ª–µ–Ω–∞` - –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ
- `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Å—Å–∏–π: {e}` - –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### –§–∞–π–ª—ã
- `active_sessions.json` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- `active_sessions.json.backup` - –±—ç–∫–∞–ø (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
- `bot.log` - –ª–æ–≥–∏ —Ä–∞–±–æ—Ç—ã

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
BACKUP_INTERVAL=3600  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—Å—Ç–∫–∏ (—Å–µ–∫—É–Ω–¥—ã)
MAX_BACKUPS=5         # –ú–∞–∫—Å–∏–º—É–º –±—ç–∫–∞–ø–æ–≤
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π, –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ `services.py`:
```python
# self._load_sessions()  # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- –§–∞–π–ª `active_sessions.json` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ user_id –∏ –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–π
- –ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ

### –û—á–∏—Å—Ç–∫–∞
- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –°—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã –æ—á–∏—â–∞—é—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- –ù–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –º—É—Å–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—ã—Å—è—á–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –º—É—Å–æ—Ä–∞
